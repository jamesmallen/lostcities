<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
<meta name="viewport" id="viewport_device" content="width=device-width, initial-scale=1">
<title>Lost Cities scorekeeper</title>
<script type='text/javascript' src='https://code.jquery.com/jquery-2.1.3.js'></script>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!--<script type='text/javascript' src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>-->
<style type='text/css'>
.left-spacer, .right-spacer {
    background-color: #FFFFFF;
}
.left-spacer {
    text-align: right;
}
.right-spacer {
    text-align: left;
}
#suit-yellow-container {
    background-color: #FFEB99;
}
#suit-blue-container {
    background-color: #E8FFFF;
}
#suit-white-container {
    background-color: #FEFEFE;
}
#suit-green-container {
    background-color: #C2F0C2;
}
#suit-red-container {
    background-color: #FFD6CC;
}
.total {
    text-align: center;
    margin-bottom: 1em;
}
.total .badge {
    padding: .3em 1.5em;
}
#overall-total {
    text-align: center;
}
#suits-container .btn-default {
    background-color: rgba(255, 255, 255, 0.4);
}
#suits-container .btn-default:active, #suits-container .btn-default.active {
    background-color: rgba(0, 0, 0, 0.4);
    color: #fff;
}
</style>

<script type='text/javascript'>//<![CDATA[ 
$(window).load(function(){

if (!String.prototype.startsWith) {
  String.prototype.startsWith = function(searchString, position) {
    position = position || 0;
    return this.indexOf(searchString, position) === position;
  };
}

suits = ['yellow', 'blue', 'white', 'green', 'red'];
cards = ['invest1', 'invest2', 'invest3', '2', '3', '4', '5', '6', '7', '8', '9', '10'];

function calculateScore() {
    console.log('calculating');
    var overallTotal = 0;
    
    for (var i = 0; i < suits.length; i++) {
        var suit = suits[i];
        console.log(suit);

        var suitTotal = 0;
        var numCards = 0;
        var multiplier = 1;

        for (var j = 0; j < cards.length; j++) {
            var card = cards[j];

            var id = suit + '-' + card;

            var checkbox = $('#' + id);

            // console.log(checkbox);

            //if (checkbox.prop('checked')) {
            if (checkbox.hasClass('active')) {
                numCards++;
                if (card.startsWith('invest')) {
                    multiplier++;
                } else {
                    suitTotal += parseInt(card);
                }
            }
        }

        console.log(suitTotal);

        if (numCards > 0) {
            suitTotal -= 20;
        }

        suitTotal *= multiplier;

        if (numCards >= 8) {
            suitTotal += 20;
        }

        $('#' + suit + '-total span').html(suitTotal);
        
        overallTotal += suitTotal;

    }
    
    $('#overall-total span').html(overallTotal);
}
for (var i = 0; i < suits.length; i++) {
    var suit = suits[i];

    var containerId = 'suit-' + suit + '-container';

    $('#suits-container').append('<div id="' + containerId + '" class="col-xs-2"></div>');


    for (var j = 0; j < cards.length; j++) {
        var card = cards[j];

        var id = suit + '-' + card;

        if (card.startsWith('invest')) {
            var cardText = '<span class="glyphicon glyphicon-hand-right"></span>';
        } else {
            var cardText = card;
        }

        // $('#' + containerId).append('<div class="checkbox suit-' + suit + ' card-' + card + '"><label><input type="checkbox" id="' + id + '">' + cardText + '</label></div>');
        $('#' + containerId).append('<div class="checkbox suit-' + suit + ' card-' + card + '"><button id="' + id + '" type="button" class="btn btn-lg btn-block btn-default">' + cardText + '</button></div>');
    }

    $('#' + containerId).append('<h3 class="total" + id="' + suit + '-total"><span class="label label-default">0</span></h2>');
}

// $('input').click(calculateScore);
$('button').click(function() {
    $(this).toggleClass('active');
    calculateScore();
})

var reverseSuits = function() {
    suitContainers = $('#suits-container .suit-container');

    suitContainersArr = suitContainers.get().reverse();

    for (var i = 0; i < suitContainersArr.length - 1; i++) {
        suitContainers.first().before(suitContainersArr[i]);
    }
}

var clearSuits = function() {
    // $('input:checkbox').prop('checked', false);
    $('button').removeClass('active');
    calculateScore();
}

$('#reverse-link').click(reverseSuits);
$('#clear-link').click(clearSuits);

if(navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/IEMobile/i)) {
    $("#viewport_device").attr("content", "width=700");
} else if(navigator.userAgent.match(/iPad/i)) {
    // $("#viewport_device").attr("content", "initial-scale = 1.00");
}

});//]]>  

</script>
</head>
<body>
<div class="container-fluid">
    <div class="row" id="suits-container">
        <div class="col-xs-1" class="left-spacer"></div>
        <div id="suit-yellow-container" class="col-xs-2 col-md-2 suit-container"></div>
        <div id="suit-blue-container" class="col-xs-2 col-md-2 suit-container"></div>
        <div id="suit-white-container" class="col-xs-2 col-md-2 suit-container"></div>
        <div id="suit-green-container" class="col-xs-2 col-md-2 suit-container"></div>
        <div id="suit-red-container" class="col-xs-2 col-md-2 suit-container"></div>
        <div class="col-xs-1 col-md-1 right-spacer">
            <h2><a href="#" id="reverse-link" role="button"><span class="glyphicon glyphicon-refresh"></span></a></p>
            <h2><a href="#" id="clear-link" role="button"><span class="glyphicon glyphicon-trash"></span></a></p>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-1 left-spacer"></div>
        <div class="col-xs-10">
             <h1 id="overall-total"><span class="label label-default">0</span></h1>
        </div>
        <div class="col-xs-1 right-spacer"></div>
    </div>
</div>
</body>
</html>